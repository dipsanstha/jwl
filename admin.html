<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - New Madi Jewellers Price Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Admin Panel Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-header {
            background: linear-gradient(135deg, #FFD700, #B8860B);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }

        .admin-header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .admin-header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-icon.gold { background: linear-gradient(135deg, #FFD700, #B8860B); }
        .stat-icon.silver { background: linear-gradient(135deg, #C0C0C0, #A0A0A0); }
        .stat-icon.users { background: linear-gradient(135deg, #4CAF50, #45a049); }
        .stat-icon.alerts { background: linear-gradient(135deg, #FF9800, #F57C00); }

        .stat-content h3 {
            color: #333;
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .stat-content p {
            color: #666;
            font-size: 0.9rem;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .admin-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .admin-card h2 {
            color: #B8860B;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Playfair Display', serif;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #FFD700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #FFD700, #B8860B);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .subscribers-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .subscribers-table th,
        .subscribers-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .subscribers-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .subscribers-table tr:hover {
            background: #f8f9fa;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge.active {
            background: #d4edda;
            color: #155724;
        }

        .badge.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .log-entry {
            padding: 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 1rem;
            background: #f8f9fa;
        }

        .log-entry .log-time {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .log-entry .log-message {
            color: #333;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.show {
            transform: translateX(0);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.online {
            background: #28a745;
        }

        .status-indicator.offline {
            background: #dc3545;
        }

        @media (max-width: 768px) {
            .admin-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .admin-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Header -->
        <div class="admin-header">
            <h1><i class="fas fa-cog"></i> Admin Panel</h1>
            <p>New Madi Jewellers - Price Management System</p>
            <div style="margin-top: 1rem;">
                <span class="status-indicator online"></span>
                <span>System Status: Online</span>
                <span style="margin-left: 2rem;">Last Update: <span id="last-system-update">Today 2:30 PM</span></span>
            </div>
        </div>

        <!-- Statistics -->
        <div class="admin-stats">
            <div class="stat-card">
                <div class="stat-icon gold">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="stat-content">
                    <h3 id="current-gold-price">NPR 155,500</h3>
                    <p>Current Gold Price (24K)</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon silver">
                    <i class="fas fa-medal"></i>
                </div>
                <div class="stat-content">
                    <h3 id="current-silver-price">NPR 1,850</h3>
                    <p>Current Silver Price</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon users">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                    <h3 id="total-subscribers">0</h3>
                    <p>Price Alert Subscribers</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon alerts">
                    <i class="fas fa-bell"></i>
                </div>
                <div class="stat-content">
                    <h3 id="alerts-sent-today">0</h3>
                    <p>Alerts Sent Today</p>
                </div>
            </div>
        </div>

        <!-- Admin Grid -->
        <div class="admin-grid">
            <!-- Manual Price Update -->
            <div class="admin-card">
                <h2><i class="fas fa-edit"></i> Manual Price Update</h2>
                <form id="price-update-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="gold-24k">Gold 24K (NPR/tola)</label>
                            <input type="number" id="gold-24k" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="gold-22k">Gold 22K (NPR/tola)</label>
                            <input type="number" id="gold-22k" step="0.01" min="0" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="gold-21k">Gold 21K (NPR/tola)</label>
                            <input type="number" id="gold-21k" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="gold-18k">Gold 18K (NPR/tola)</label>
                            <input type="number" id="gold-18k" step="0.01" min="0" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="silver-price">Silver Price (NPR/tola)</label>
                        <input type="number" id="silver-price" step="0.01" min="0" required>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Update Prices
                    </button>
                    <button type="button" id="fetch-live-prices" class="btn btn-secondary">
                        <i class="fas fa-sync-alt"></i> Fetch Live Prices
                    </button>
                </form>
            </div>

            <!-- System Controls -->
            <div class="admin-card">
                <h2><i class="fas fa-sliders-h"></i> System Controls</h2>
                <div class="form-group">
                    <label for="update-frequency">Auto Update Frequency</label>
                    <select id="update-frequency">
                        <option value="15">Every 15 minutes</option>
                        <option value="30" selected>Every 30 minutes</option>
                        <option value="60">Every hour</option>
                        <option value="120">Every 2 hours</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="alert-threshold">Price Change Alert Threshold (%)</label>
                    <input type="number" id="alert-threshold" value="1" min="0.1" step="0.1">
                </div>
                
                <div class="form-group" style="margin-bottom: 2rem;">
                    <label>
                        <input type="checkbox" id="auto-updates" checked>
                        Enable automatic price updates
                    </label>
                </div>
                
                <button id="save-settings" class="btn btn-primary">
                    <i class="fas fa-cog"></i> Save Settings
                </button>
                
                <button id="send-test-alert" class="btn btn-secondary">
                    <i class="fas fa-paper-plane"></i> Send Test Alert
                </button>
                
                <button id="backup-data" class="btn btn-success">
                    <i class="fas fa-download"></i> Backup Data
                </button>
            </div>
        </div>

        <!-- Full Width Cards -->
        <div class="admin-grid">
            <!-- Subscriber Management -->
            <div class="admin-card full-width">
                <h2><i class="fas fa-users"></i> Subscriber Management</h2>
                <div style="margin-bottom: 1rem;">
                    <button id="refresh-subscribers" class="btn btn-secondary">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button id="export-subscribers" class="btn btn-success">
                        <i class="fas fa-download"></i> Export CSV
                    </button>
                </div>
                
                <table class="subscribers-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Subscribed Date</th>
                            <th>Daily Updates</th>
                            <th>Weekly Reports</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="subscribers-table-body">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 2rem; color: #666;">
                                <i class="fas fa-inbox"></i> No subscribers found
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Activity Log -->
        <div class="admin-card full-width">
            <h2><i class="fas fa-history"></i> Activity Log</h2>
            <div style="margin-bottom: 1rem;">
                <button id="clear-log" class="btn btn-danger">
                    <i class="fas fa-trash"></i> Clear Log
                </button>
                <button id="refresh-log" class="btn btn-secondary">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            
            <div id="activity-log">
                <div class="log-entry">
                    <div class="log-time">2025-09-20 14:16:32</div>
                    <div class="log-message">
                        <i class="fas fa-info-circle" style="color: #2196F3;"></i>
                        System initialized successfully
                    </div>
                </div>
                <div class="log-entry">
                    <div class="log-time">2025-09-20 14:15:00</div>
                    <div class="log-message">
                        <i class="fas fa-sync-alt" style="color: #28a745;"></i>
                        Price data synchronized from external sources
                    </div>
                </div>
                <div class="log-entry">
                    <div class="log-time">2025-09-20 14:00:00</div>
                    <div class="log-message">
                        <i class="fas fa-bell" style="color: #FF9800;"></i>
                        Daily price summary sent to 0 subscribers
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Area -->
    <div id="notification" class="notification"></div>

    <!-- Admin JavaScript -->
    <script>
        class AdminPanel {
            constructor() {
                this.priceManager = null;
                this.subscribers = [];
                this.activityLog = [];
                
                this.init();
            }

            async init() {
                this.loadPriceManager();
                this.setupEventListeners();
                this.loadCurrentPrices();
                this.loadSubscribers();
                this.startRealTimeUpdates();
            }

            loadPriceManager() {
                // Wait for price manager to be available
                const checkPriceManager = () => {
                    if (window.nepalPriceManager) {
                        this.priceManager = window.nepalPriceManager;
                        this.loadCurrentPrices();
                    } else {
                        setTimeout(checkPriceManager, 1000);
                    }
                };
                checkPriceManager();
            }

            setupEventListeners() {
                // Price update form
                document.getElementById('price-update-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updatePricesManually();
                });

                // Fetch live prices
                document.getElementById('fetch-live-prices').addEventListener('click', () => {
                    this.fetchLivePrices();
                });

                // Save settings
                document.getElementById('save-settings').addEventListener('click', () => {
                    this.saveSettings();
                });

                // Send test alert
                document.getElementById('send-test-alert').addEventListener('click', () => {
                    this.sendTestAlert();
                });

                // Backup data
                document.getElementById('backup-data').addEventListener('click', () => {
                    this.backupData();
                });

                // Refresh subscribers
                document.getElementById('refresh-subscribers').addEventListener('click', () => {
                    this.loadSubscribers();
                });

                // Export subscribers
                document.getElementById('export-subscribers').addEventListener('click', () => {
                    this.exportSubscribers();
                });

                // Clear log
                document.getElementById('clear-log').addEventListener('click', () => {
                    this.clearActivityLog();
                });

                // Refresh log
                document.getElementById('refresh-log').addEventListener('click', () => {
                    this.refreshActivityLog();
                });
            }

            loadCurrentPrices() {
                if (!this.priceManager) return;

                const currentPrices = this.priceManager.getCurrentPrices();
                
                if (currentPrices.gold) {
                    document.getElementById('gold-24k').value = currentPrices.gold['24k']?.price || '';
                    document.getElementById('gold-22k').value = currentPrices.gold['22k']?.price || '';
                    document.getElementById('gold-21k').value = currentPrices.gold['21k']?.price || '';
                    document.getElementById('gold-18k').value = currentPrices.gold['18k']?.price || '';
                    
                    document.getElementById('current-gold-price').textContent = 
                        `NPR ${(currentPrices.gold['24k']?.price || 0).toLocaleString()}`;
                }

                if (currentPrices.silver?.pure) {
                    document.getElementById('silver-price').value = currentPrices.silver.pure.price || '';
                    document.getElementById('current-silver-price').textContent = 
                        `NPR ${(currentPrices.silver.pure.price || 0).toLocaleString()}`;
                }
            }

            loadSubscribers() {
                if (!this.priceManager) {
                    setTimeout(() => this.loadSubscribers(), 1000);
                    return;
                }

                this.subscribers = this.priceManager.subscribers || [];
                document.getElementById('total-subscribers').textContent = this.subscribers.length;
                
                const tableBody = document.getElementById('subscribers-table-body');
                
                if (this.subscribers.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 2rem; color: #666;">
                                <i class="fas fa-inbox"></i> No subscribers found
                            </td>
                        </tr>
                    `;
                    return;
                }

                tableBody.innerHTML = this.subscribers.map(subscriber => `
                    <tr>
                        <td>${subscriber.email}</td>
                        <td>${new Date(subscriber.subscribedAt).toLocaleDateString()}</td>
                        <td>
                            <span class="badge ${subscriber.preferences?.dailyUpdate ? 'active' : 'inactive'}">
                                ${subscriber.preferences?.dailyUpdate ? 'Yes' : 'No'}
                            </span>
                        </td>
                        <td>
                            <span class="badge ${subscriber.preferences?.weeklyReport ? 'active' : 'inactive'}">
                                ${subscriber.preferences?.weeklyReport ? 'Yes' : 'No'}
                            </span>
                        </td>
                        <td>
                            <span class="badge active">Active</span>
                        </td>
                        <td>
                            <button class="btn btn-danger" style="padding: 4px 8px; font-size: 0.8rem;" 
                                    onclick="adminPanel.removeSubscriber('${subscriber.email}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            }

            async updatePricesManually() {
                const gold24k = parseFloat(document.getElementById('gold-24k').value);
                const gold22k = parseFloat(document.getElementById('gold-22k').value);
                const gold21k = parseFloat(document.getElementById('gold-21k').value);
                const gold18k = parseFloat(document.getElementById('gold-18k').value);
                const silver = parseFloat(document.getElementById('silver-price').value);

                if (!this.priceManager) {
                    this.showNotification('Price manager not available', 'error');
                    return;
                }

                const newPrices = {
                    gold: {
                        '24k': { 
                            price: gold24k, 
                            change: '+0.0',
                            changePercent: '+0.0%',
                            lastUpdate: new Date().toISOString() 
                        },
                        '22k': { 
                            price: gold22k, 
                            change: '+0.0',
                            changePercent: '+0.0%',
                            lastUpdate: new Date().toISOString() 
                        },
                        '21k': { 
                            price: gold21k, 
                            change: '+0.0',
                            changePercent: '+0.0%',
                            lastUpdate: new Date().toISOString() 
                        },
                        '18k': { 
                            price: gold18k, 
                            change: '+0.0',
                            changePercent: '+0.0%',
                            lastUpdate: new Date().toISOString() 
                        }
                    },
                    silver: {
                        pure: { 
                            price: silver, 
                            change: '+0.0',
                            changePercent: '+0.0%',
                            lastUpdate: new Date().toISOString() 
                        }
                    }
                };

                try {
                    await this.priceManager.updatePrices(newPrices);
                    this.showNotification('Prices updated successfully!', 'success');
                    this.loadCurrentPrices();
                    this.logActivity('Manual price update completed', 'success');
                } catch (error) {
                    this.showNotification('Error updating prices: ' + error.message, 'error');
                    this.logActivity('Manual price update failed: ' + error.message, 'error');
                }
            }

            async fetchLivePrices() {
                if (!this.priceManager) {
                    this.showNotification('Price manager not available', 'error');
                    return;
                }

                const fetchBtn = document.getElementById('fetch-live-prices');
                const originalText = fetchBtn.innerHTML;
                
                fetchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Fetching...';
                fetchBtn.disabled = true;

                try {
                    await this.priceManager.fetchLivePrices();
                    this.showNotification('Live prices fetched successfully!', 'success');
                    this.loadCurrentPrices();
                    this.logActivity('Live price fetch completed', 'success');
                } catch (error) {
                    this.showNotification('Error fetching live prices: ' + error.message, 'error');
                    this.logActivity('Live price fetch failed: ' + error.message, 'error');
                } finally {
                    fetchBtn.innerHTML = originalText;
                    fetchBtn.disabled = false;
                }
            }

            saveSettings() {
                const updateFrequency = document.getElementById('update-frequency').value;
                const alertThreshold = document.getElementById('alert-threshold').value;
                const autoUpdates = document.getElementById('auto-updates').checked;

                // Save settings to localStorage
                const settings = {
                    updateFrequency: parseInt(updateFrequency),
                    alertThreshold: parseFloat(alertThreshold),
                    autoUpdates: autoUpdates,
                    lastSaved: new Date().toISOString()
                };

                localStorage.setItem('adminSettings', JSON.stringify(settings));
                this.showNotification('Settings saved successfully!', 'success');
                this.logActivity('Admin settings updated', 'info');
            }

            sendTestAlert() {
                if (!this.priceManager) {
                    this.showNotification('Price manager not available', 'error');
                    return;
                }

                const testMessage = 'This is a test alert from New Madi Jewellers price management system.';
                this.priceManager.showNotification('Test Alert - New Madi Jewellers', testMessage);
                this.showNotification('Test alert sent!', 'success');
                this.logActivity('Test alert sent', 'info');
            }

            backupData() {
                if (!this.priceManager) {
                    this.showNotification('Price manager not available', 'error');
                    return;
                }

                const backupData = {
                    timestamp: new Date().toISOString(),
                    currentPrices: this.priceManager.getCurrentPrices(),
                    priceHistory: this.priceManager.getPriceHistory(30),
                    subscribers: this.subscribers,
                    activityLog: this.activityLog
                };

                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `newmadi_backup_${new Date().toISOString().split('T')[0]}.json`;
                link.click();

                this.showNotification('Data backup downloaded!', 'success');
                this.logActivity('Data backup created and downloaded', 'success');
            }

            exportSubscribers() {
                if (this.subscribers.length === 0) {
                    this.showNotification('No subscribers to export', 'error');
                    return;
                }

                const csvContent = [
                    'Email,Subscribed Date,Daily Updates,Weekly Reports,Status',
                    ...this.subscribers.map(sub => 
                        `${sub.email},${new Date(sub.subscribedAt).toLocaleDateString()},${sub.preferences?.dailyUpdate ? 'Yes' : 'No'},${sub.preferences?.weeklyReport ? 'Yes' : 'No'},Active`
                    )
                ].join('\n');

                const blob = new Blob([csvContent], { type: 'text/csv' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `subscribers_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();

                this.showNotification('Subscribers list exported!', 'success');
                this.logActivity(`Exported ${this.subscribers.length} subscribers to CSV`, 'info');
            }

            async removeSubscriber(email) {
                if (confirm(`Are you sure you want to remove ${email} from the subscriber list?`)) {
                    if (this.priceManager) {
                        await this.priceManager.unsubscribeFromAlerts(email);
                        this.loadSubscribers();
                        this.showNotification(`Removed ${email} from subscribers`, 'success');
                        this.logActivity(`Removed subscriber: ${email}`, 'info');
                    }
                }
            }

            clearActivityLog() {
                if (confirm('Are you sure you want to clear the activity log?')) {
                    this.activityLog = [];
                    document.getElementById('activity-log').innerHTML = `
                        <div class="log-entry">
                            <div class="log-time">${new Date().toLocaleString()}</div>
                            <div class="log-message">
                                <i class="fas fa-broom" style="color: #28a745;"></i>
                                Activity log cleared
                            </div>
                        </div>
                    `;
                    this.showNotification('Activity log cleared', 'success');
                }
            }

            refreshActivityLog() {
                // Reload recent activities
                this.logActivity('Activity log refreshed', 'info');
                this.showNotification('Activity log refreshed', 'success');
            }

            logActivity(message, type = 'info') {
                const logEntry = {
                    timestamp: new Date().toISOString(),
                    message: message,
                    type: type
                };

                this.activityLog.unshift(logEntry);
                
                // Keep only last 50 entries
                this.activityLog = this.activityLog.slice(0, 50);

                // Update UI
                const iconClass = type === 'success' ? 'fa-check-circle' : 
                                type === 'error' ? 'fa-exclamation-triangle' : 
                                type === 'warning' ? 'fa-exclamation-circle' : 'fa-info-circle';
                
                const iconColor = type === 'success' ? '#28a745' : 
                                type === 'error' ? '#dc3545' : 
                                type === 'warning' ? '#ffc107' : '#2196F3';

                const logHtml = `
                    <div class="log-entry">
                        <div class="log-time">${new Date().toLocaleString()}</div>
                        <div class="log-message">
                            <i class="fas ${iconClass}" style="color: ${iconColor};"></i>
                            ${message}
                        </div>
                    </div>
                `;

                const activityLog = document.getElementById('activity-log');
                activityLog.insertAdjacentHTML('afterbegin', logHtml);
            }

            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 4000);
            }

            startRealTimeUpdates() {
                // Update statistics every minute
                setInterval(() => {
                    if (this.priceManager) {
                        this.loadCurrentPrices();
                        document.getElementById('last-system-update').textContent = 
                            new Date().toLocaleString();
                    }
                }, 60000);

                // Update subscriber count every 30 seconds
                setInterval(() => {
                    this.loadSubscribers();
                }, 30000);
            }
        }

        // Initialize admin panel
        let adminPanel;
        window.addEventListener('load', () => {
            adminPanel = new AdminPanel();
            window.adminPanel = adminPanel;
        });

        // Load existing settings
        window.addEventListener('DOMContentLoaded', () => {
            const settings = localStorage.getItem('adminSettings');
            if (settings) {
                const parsed = JSON.parse(settings);
                document.getElementById('update-frequency').value = parsed.updateFrequency || 30;
                document.getElementById('alert-threshold').value = parsed.alertThreshold || 1;
                document.getElementById('auto-updates').checked = parsed.autoUpdates !== false;
            }
        });
    </script>

    <!-- Load price manager if available -->
    <script>
        // Try to load the price manager from the main site
        const script1 = document.createElement('script');
        script1.src = 'js/priceManager.js';
        script1.onerror = () => {
            console.warn('Could not load price manager from main site');
        };
        document.head.appendChild(script1);
    </script>
</body>
</html>